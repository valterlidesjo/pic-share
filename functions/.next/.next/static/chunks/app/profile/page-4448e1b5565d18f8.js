(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{3586:(e,l,r)=>{"use strict";r.d(l,{I:()=>o,db:()=>d,j:()=>c});var s=r(16203),t=r(23915),a=r(35317),i=r(90858);let n=(0,t.Wp)({apiKey:"AIzaSyDLn-Qoqt0XSx9Fr7jdTqXt54rtzboGcUw",authDomain:"pic-share-be97b.firebaseapp.com",projectId:"pic-share-be97b",storageBucket:"pic-share-be97b.firebasestorage.app",messagingSenderId:"717613380259",appId:"1:717613380259:web:bc5443d92ec0ee76b20516",measurementId:"G-L1DP17QLDW"}),o=(0,i.c7)(n),d=(0,a.aU)(n),c=(0,s.xI)(n)},6994:(e,l,r)=>{"use strict";r.d(l,{A:()=>n});var s=r(12115),t=r(8731),a=r(35695),i=r(3586);let n=()=>{let[e,l]=(0,t.hD)(i.j),r=(0,a.useRouter)();return(0,s.useEffect)(()=>{let s=null==e?void 0:e.isAnonymous;l||e||!s||r.push("/sign-in")},[e,l,r]),{user:e,loading:l}}},26889:(e,l,r)=>{"use strict";r.d(l,{K:()=>i});var s=r(12115),t=r(35317),a=r(3586);let i=e=>{let[l,r]=(0,s.useState)([]),[i,n]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!e)return void r([]);let l=(0,t.P)((0,t.rJ)(a.db,"images"),(0,t._M)("userId","==",e)),s=(0,t.aQ)(l,e=>{r(e.docs.map(e=>{var l;let r=e.data(),s=(null==(l=r.uploadedAt)?void 0:l.toDate)?r.uploadedAt.toDate():new Date;return{id:e.id,userId:r.userId,imageUrl:r.imageUrl,fileName:r.fileName,uploadedAt:s,email:r.email}}))},e=>{console.error("Error collecting images:",e),n("Could not load images")});return()=>s()},[e]),{images:l,error:i}}},38270:(e,l,r)=>{"use strict";r.d(l,{A:()=>n});var s=r(12115),t=r(35317),a=r(3586),i=r(6994);function n(){let[e,l]=(0,s.useState)(null),{user:r}=(0,i.A)();return(0,s.useEffect)(()=>{(async()=>{let e=null==r?void 0:r.uid,s=(null==r?void 0:r.email)||"";if(!e)return l(null);try{let r=(0,t.H9)(a.db,"users",e),i=await (0,t.x7)(r);i.exists()?l({email:s,...i.data()}):l({email:s})}catch(e){console.error("Error fetching user info: ",e),l(null)}})()},[r]),{userInfo:e}}},39465:(e,l,r)=>{"use strict";r.r(l),r.d(l,{default:()=>R});var s=r(95155),t=r(6994),a=r(12115),i=r(68534),n=r(16203),o=r(3586),d=r(38270),c=r(60744),u=r(56278),m=r(54492),x=r(99927),f=r(76871),h=r(90044),j=r(71977),p=r(35317);let g=a.forwardRef(function(e,l){return(0,s.jsx)(c.A,{direction:"up",ref:l,...e})}),v=e=>{let{user:l,userInfo:r}=e,[t,n]=(0,a.useState)(!1),[d,c]=(0,a.useState)(""),[v,y]=(0,a.useState)(null),A=async()=>{if(null==l?void 0:l.uid)try{await (0,p.mZ)((0,p.H9)(o.db,"users",l.uid),{username:d}),y("Username added successfully: ".concat(d))}catch(e){console.error("Error adding username: ",e),y("Error adding username")}};return(null==r?void 0:r.username)?(0,s.jsxs)("p",{children:["Email: ",r.email]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-2xl pb-2 pt-8",children:"Do you want to add a username to your account?"}),(0,s.jsx)(i.A,{variant:"outlined",onClick:()=>n(!0),sx:{width:"100%",color:"#E38724"},children:"Add username"}),(0,s.jsxs)(u.A,{open:t,slots:{transition:g},keepMounted:!0,onClose:()=>n(!1),"aria-describedby":"alert-dialog-slide-description",children:[(0,s.jsx)(m.A,{children:"Add a username to your profile"}),(0,s.jsxs)(x.A,{children:[(0,s.jsxs)(f.A,{id:"alert-dialog-slide-description",children:["Adding a username to your profile will allow you to be recognized by other users. You can also change your username later if you want."," ",(0,s.jsx)("br",{}),"Without a username your email will be displayed instead."]}),(0,s.jsx)(h.A,{label:"Username",value:d,onChange:e=>c(e.target.value),className:"mt-2"})]}),(0,s.jsxs)(j.A,{children:[(0,s.jsx)(i.A,{variant:"outlined",onClick:()=>n(!1),children:"Don't add"}),(0,s.jsx)(i.A,{variant:"outlined",onClick:()=>{n(!1),A()},children:"Add username"})]})]}),v&&(0,s.jsx)("p",{children:v})]})};var y=r(28890),A=r(74802),w=r(19505),b=r(76080),N=r(74588),k=r(62249);let C=async(e,l)=>{try{let r=(0,p.H9)(o.db,"images",e);await (0,p.mZ)(r,{fileName:l}),console.log("Image ".concat(e," updated with new file name: ").concat(l))}catch(e){console.error("Error updating filename:",e)}},E=async e=>{try{let l=(0,p.H9)(o.db,"images",e);await (0,p.kd)(l),console.log("Image ".concat(e," deleted successfully"))}catch(e){console.error("Error deleting image:",e)}};var S=r(66766);let I=e=>{let{image:l}=e,[r,t]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)("");return(0,s.jsxs)("div",{className:"border p-2 rounded-lg shadow-md mb-8",children:[(0,s.jsx)("div",{className:"relative w-full h-48 mb-2",children:(0,s.jsx)(S.default,{src:l.imageUrl,alt:l.fileName||"Galleri Bild",fill:!0,className:"object-cover rounded-md"})}),(0,s.jsx)("div",{className:"flex items-center justify-start gap-2",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.A,{label:l.fileName,value:d,onChange:e=>c(e.target.value)}),(0,s.jsx)(A.A,{onClick:()=>{C(l.id,d),t(!1),c("")}}),(0,s.jsx)(N.A,{onClick:()=>{t(!1),c("")}})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-base font-semibold truncate",children:(0,k.S)(l.fileName)}),(0,s.jsx)(y.A,{fontSize:"small",onClick:()=>t(!0)})]})}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 py-2",children:["Uploaded: ",l.uploadedAt.toLocaleDateString()]}),(0,s.jsx)("div",{children:(0,s.jsx)(i.A,{variant:"outlined",color:"error",startIcon:(0,s.jsx)(w.A,{}),onClick:()=>o(!n),children:"Delete"})}),n&&(0,s.jsxs)("div",{className:"flex items-center justify-start gap-2 mt-2",children:[(0,s.jsx)("p",{children:"Are you sure you want to delete this image?"}),(0,s.jsx)(b.A,{className:"text-red-500 cursor-pointer",onClick:()=>{E(l.id),o(!1)}}),(0,s.jsx)(N.A,{className:"cursor-pointer",onClick:()=>o(!1)})]})]})};var U=r(35695);let D=e=>{let{children:l}=e,{user:r,loading:i}=(0,t.A)(),n=(0,U.useRouter)();return((0,a.useEffect)(()=>{i||r&&!r.isAnonymous||"sign-in"===window.location.pathname||n.push("/sign-in")},[r,i,n]),i)?(0,s.jsx)("p",{children:"Loading..."}):r?(0,s.jsx)(s.Fragment,{children:l}):null},F=async e=>{var l,r;return await (null==(l=o.j.currentUser)?void 0:l.reload()),null!=(r=o.j.currentUser)&&!!r.emailVerified&&(await (0,p.mZ)((0,p.H9)(o.db,"users",e),{emailVerified:!0}),!0)};var P=r(26889);let _=e=>{let[l,r]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e)return void r(null);let l=(0,p.P)((0,p.rJ)(o.db,"followers"),(0,p._M)("followedId","==",e)),s=(0,p.aQ)(l,e=>{r(e.size)});return()=>s()},[e]),{followerCount:l}},H=a.forwardRef(function(e,l){return(0,s.jsx)(c.A,{direction:"up",ref:l,...e})}),L=e=>{let{user:l}=e,[r,t]=(0,a.useState)(!1),[n,d]=(0,a.useState)(""),[c,g]=(0,a.useState)(null),v=async()=>{if(null==l?void 0:l.uid)try{await (0,p.mZ)((0,p.H9)(o.db,"users",l.uid),{username:n}),g("Username edited to ".concat(n," successfully!"))}catch(e){console.error("Error editing username: ",e),g("Error editing username")}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.A,{variant:"outlined",onClick:()=>t(!0),sx:{width:"100%",color:"#E38724"},children:"Edit Account"}),(0,s.jsxs)(u.A,{open:r,slots:{transition:H},keepMounted:!0,onClose:()=>t(!1),"aria-describedby":"alert-dialog-slide-description",children:[(0,s.jsx)(m.A,{children:"Edit the username of your profile"}),(0,s.jsxs)(x.A,{children:[(0,s.jsxs)(f.A,{id:"alert-dialog-slide-description",children:["A username is a perfect way to uniquify your account.",(0,s.jsx)("br",{}),"Here you can edit your username."]}),(0,s.jsx)(h.A,{label:"New Username",value:n,onChange:e=>d(e.target.value),sx:{marginTop:"1rem"}})]}),(0,s.jsxs)(j.A,{children:[(0,s.jsx)(i.A,{variant:"outlined",onClick:()=>t(!1),children:"Don't edit"}),(0,s.jsx)(i.A,{variant:"outlined",onClick:()=>{t(!1),v()},children:"Edit username"})]})]}),c&&(0,s.jsx)("p",{children:c})]})},z=()=>{let{user:e,loading:l}=(0,t.A)(),{userInfo:r}=(0,d.A)(),[c,u]=(0,a.useState)(""),[,m]=(0,a.useState)(0),{images:x}=(0,P.K)(null==e?void 0:e.uid),{followerCount:f}=_(null==e?void 0:e.uid),h=async()=>{(null==e?void 0:e.uid)?(u(await F(null==e?void 0:e.uid)?"Email verified!":"Still not verified. Please check your email."),m(e=>e+1)):console.log("No user found")},j=async()=>{o.j.currentUser&&(await (0,n.gA)(o.j.currentUser),u("Verification email sent!"))};return l?(0,s.jsx)("div",{children:"Loading..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center px-8",children:[(0,s.jsx)("h1",{className:"text-[#1976D2] font-bold text-2xl",children:"Profile"}),(0,s.jsxs)("div",{className:"flex flex-col w-full justify-center items-center sm:max-w-[512px]",children:[(0,s.jsxs)("p",{className:"text-2xl w-full text-left",children:["Welcome to your profile page"," ",(null==r?void 0:r.username)?r.username:null==r?void 0:r.email]}),(0,s.jsxs)("p",{className:"text-2xl py-8 w-full text-left",children:["Followers: ",f]}),(0,s.jsx)("p",{className:"text-2xl pb-8",children:"Scroll down to browse all your uploaded images, add custom names, edit and delete."}),!(null==r?void 0:r.emailVerified)&&(0,s.jsxs)("div",{className:"flex flex-col justify-start items-center w-full",children:[(0,s.jsx)("p",{className:"text-2xl w-full text-left",children:"Please verify to complete your account."}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,s.jsx)(i.A,{variant:"outlined",onClick:h,sx:{width:"100%",color:"#E38724"},children:"I have verified my email"}),(0,s.jsx)(i.A,{variant:"outlined",onClick:j,sx:{width:"100%",color:"#E38724"},children:"Please resend verification"}),(0,s.jsx)("p",{className:"text-xl font-bold",children:"Remember to check your spam inbox."})]}),(0,s.jsx)("p",{children:c})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 w-full sm:max-w-[512px]",children:[(0,s.jsx)(L,{user:e}),(0,s.jsx)(i.A,{variant:"outlined",color:"error",onClick:()=>(0,n.CI)(o.j),sx:{width:"100%"},children:"Log out"})]})]}),!(null==r?void 0:r.username)&&(0,s.jsx)(v,{user:e,userInfo:r})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 w-full max-w-5xl p-8",children:x.map(e=>(0,s.jsx)(I,{image:e},e.id))})]})},R=()=>(0,s.jsx)(D,{children:(0,s.jsx)(z,{})})},62249:(e,l,r)=>{"use strict";r.d(l,{S:()=>s});let s=e=>{if(!e)return"";let l=e.lastIndexOf("."),r=e;return(l>0&&(r=e.substring(0,l)),0===r.length)?"":r.charAt(0).toUpperCase()+r.slice(1)}},67035:(e,l,r)=>{Promise.resolve().then(r.bind(r,39465))}},e=>{var l=l=>e(e.s=l);e.O(0,[992,163,577,766,112,831,208,424,44,334,441,684,358],()=>l(67035)),_N_E=e.O()}]);